# orgjournal-mcp 実装計画

## 現在の状態

✅ **Phase 0: 初期実装完了 (2026-01-04)**
- MCP サーバーの基本実装
- 3つのツール実装:
  - `get_journal_entries`: 日付範囲指定でエントリー取得
  - `search_journal`: キーワード検索
  - `get_recent_entries`: 直近N日間のエントリー取得
- FastMCP を使用したサーバー実装
- パッケージ構成の完成
- ドキュメント (README.md, LICENSE)
- MCP クライアントでの動作確認済み

詳細: [.claude/completed/2026-01-04-initial-implementation.md](.claude/completed/2026-01-04-initial-implementation.md)

✅ **Phase 2: テスト追加完了 (2026-01-04)**
- テストフレームワークのセットアップ (pytest, pytest-cov, pytest-asyncio)
- テストディレクトリ構造の作成 (tests/, tests/fixtures/)
- テストフィクスチャファイルの作成 (サンプル Org ファイル 3つ)
- ユニットテストの実装:
  - `test_converter.py`: 37個のテスト (変換ロジック)
  - `test_server.py`: 12個のテスト (MCP ツール)
  - `test_config.py`: 7個のテスト (設定)
- GitHub Actions CI 設定 (.github/workflows/test.yml)
- README.md にテスト実行方法を追加
- **テスト結果**: 52個のテストが全て成功、カバレッジ 95%

✅ **Phase 3.1: タグフィルタリング機能完了 (2026-01-04)**
- `filter_entries_by_tags` ヘルパー関数を `converter.py` に追加
- `get_entries_by_tag` ツールを `server.py` に実装
- デフォルトで "chore" タグを除外する機能
- include/exclude タグの組み合わせをサポート
- ユニットテストの追加:
  - `test_converter.py`: 9個のテスト (タグフィルタリングロジック)
  - `test_server.py`: 8個のテスト (get_entries_by_tag ツール + 統合テスト)
- README.md にツールの詳細説明を追加
- **テスト結果**: 69個のテストが全て成功、カバレッジ 95%

---

## 次のステップ

### Phase 1: CLI 機能の実装（オプション）

現在、MCP サーバーとしての機能は完成していますが、スタンドアロンの CLI ツールとしても使えるようにする。

**実装内容:**
- `src/orgjournal_mcp/cli.py` の作成
- argparse を使ったコマンドラインインターフェース
- JSON 出力機能

**使用例:**
```bash
# 直近7日間のエントリーを取得
uv run orgjournal-mcp get --last-days 7

# キーワード検索
uv run orgjournal-mcp search "meeting"

# JSON ファイルに出力
uv run orgjournal-mcp get --last-days 30 -o output.json
```

**優先度:** 低（MCP サーバーが主な用途のため）

---


### Phase 3: 機能拡張

#### 3.2 統計情報の提供
ジャーナルの統計情報を取得できるようにする。

**新しいツール:**
- `get_journal_stats`: 統計情報取得

**返す情報:**
- エントリー総数
- 期間
- よく使われるタグ Top 10
- 日別エントリー数

#### 3.3 エクスポート機能
- Markdown 形式でのエクスポート
- CSV 形式でのエクスポート

**優先度:** 低

---

### Phase 4: パフォーマンス最適化

**検討事項:**
- 大量のエントリーを扱う場合のメモリ使用量削減
- ファイル読み込みのキャッシング
- インデックスの作成（頻繁に検索する場合）

**優先度:** 低（現時点では問題なし）

---

### Phase 5: エラーハンドリングとロギング

**改善点:**
- より詳細なエラーメッセージ
- ロギング機能の追加（デバッグ用）
- ジャーナルファイルが見つからない場合の適切な処理
- 不正な org ファイル形式への対処

**優先度:** 中

---

### Phase 6: ドキュメントの充実

**追加するドキュメント:**
- 使用例の追加（より具体的なユースケース）
- トラブルシューティングガイド
- 開発者向けドキュメント（コントリビューションガイド）
- API リファレンス

**優先度:** 低

---

## 将来的な検討事項

### カスタマイズ可能な設定
- 設定ファイル（`.orgjournal-mcp.toml` など）のサポート
- ジャーナルディレクトリの柔軟な設定
- エントリーレベルのカスタマイズ（現在は level 4 固定）

### 他の Org-mode 機能のサポート
- TODO 状態の取得
- SCHEDULED/DEADLINE の処理
- プロパティの取得

### リアルタイム監視
- ジャーナルファイルの変更を監視して自動更新

---

## 注意事項

- 現在の実装は **レベル 4 の見出し** (`****`) のみを処理対象としています
- タイムスタンプが存在しないエントリーはスキップされます
- デフォルトのジャーナルディレクトリは `~/Documents/org/p1-journal/` です

---

## 変更履歴

- **2026-01-04**: 初期実装完了、MCP サーバーとして動作確認済み
- **2026-01-04**: Phase 2 完了 - テストの追加 (52テスト、カバレッジ95%)
- **2026-01-04**: Phase 3.1 完了 - タグフィルタリング機能 (69テスト、カバレッジ95%)
