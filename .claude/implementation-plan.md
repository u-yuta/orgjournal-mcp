# orgjournal-mcp 実装計画

## 現在の状態

✅ **完了済み (2026-01-04)**
- MCP サーバーの基本実装
- 3つのツール実装:
  - `get_journal_entries`: 日付範囲指定でエントリー取得
  - `search_journal`: キーワード検索
  - `get_recent_entries`: 直近N日間のエントリー取得
- FastMCP を使用したサーバー実装
- パッケージ構成の完成
- ドキュメント (README.md, LICENSE)
- MCP クライアントでの動作確認済み

詳細: [.claude/completed/2026-01-04-initial-implementation.md](.claude/completed/2026-01-04-initial-implementation.md)

---

## 次のステップ

### Phase 1: CLI 機能の実装（オプション）

現在、MCP サーバーとしての機能は完成していますが、スタンドアロンの CLI ツールとしても使えるようにする。

**実装内容:**
- `src/orgjournal_mcp/cli.py` の作成
- argparse を使ったコマンドラインインターフェース
- JSON 出力機能

**使用例:**
```bash
# 直近7日間のエントリーを取得
uv run orgjournal-mcp get --last-days 7

# キーワード検索
uv run orgjournal-mcp search "meeting"

# JSON ファイルに出力
uv run orgjournal-mcp get --last-days 30 -o output.json
```

**優先度:** 低（MCP サーバーが主な用途のため）

---

### Phase 2: テストの追加

**実装内容:**
- `tests/` ディレクトリの作成
- ユニットテスト:
  - `test_converter.py`: 変換ロジックのテスト
  - `test_server.py`: MCP ツールのテスト
  - `test_config.py`: 設定のテスト
- テストデータの準備（サンプル org ファイル）
- CI/CD の設定（GitHub Actions）

**使用するツール:**
- pytest
- pytest-asyncio (非同期テスト用)

**優先度:** 中

---

### Phase 3: 機能拡張

#### 3.1 タグフィルタリング機能
特定のタグでフィルタリングできるようにする。

**新しいツール:**
- `get_entries_by_tag`: タグでフィルタリング

**例:**
```python
# "work" タグのエントリーのみ取得
get_entries_by_tag(tags=["work"], last_days=30)
```

#### 3.2 統計情報の提供
ジャーナルの統計情報を取得できるようにする。

**新しいツール:**
- `get_journal_stats`: 統計情報取得

**返す情報:**
- エントリー総数
- 期間
- よく使われるタグ Top 10
- 日別エントリー数

#### 3.3 エクスポート機能
- Markdown 形式でのエクスポート
- CSV 形式でのエクスポート

**優先度:** 低

---

### Phase 4: パフォーマンス最適化

**検討事項:**
- 大量のエントリーを扱う場合のメモリ使用量削減
- ファイル読み込みのキャッシング
- インデックスの作成（頻繁に検索する場合）

**優先度:** 低（現時点では問題なし）

---

### Phase 5: エラーハンドリングとロギング

**改善点:**
- より詳細なエラーメッセージ
- ロギング機能の追加（デバッグ用）
- ジャーナルファイルが見つからない場合の適切な処理
- 不正な org ファイル形式への対処

**優先度:** 中

---

### Phase 6: ドキュメントの充実

**追加するドキュメント:**
- 使用例の追加（より具体的なユースケース）
- トラブルシューティングガイド
- 開発者向けドキュメント（コントリビューションガイド）
- API リファレンス

**優先度:** 低

---

## 将来的な検討事項

### カスタマイズ可能な設定
- 設定ファイル（`.orgjournal-mcp.toml` など）のサポート
- ジャーナルディレクトリの柔軟な設定
- エントリーレベルのカスタマイズ（現在は level 4 固定）

### 他の Org-mode 機能のサポート
- TODO 状態の取得
- SCHEDULED/DEADLINE の処理
- プロパティの取得

### リアルタイム監視
- ジャーナルファイルの変更を監視して自動更新

---

## 注意事項

- 現在の実装は **レベル 4 の見出し** (`****`) のみを処理対象としています
- タイムスタンプが存在しないエントリーはスキップされます
- デフォルトのジャーナルディレクトリは `~/Documents/org/p1-journal/` です

---

## 変更履歴

- **2026-01-04**: 初期実装完了、MCP サーバーとして動作確認済み
