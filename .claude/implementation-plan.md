# orgjournal-mcp 実装計画

## 現在の状態

✅ **Phase 0: 初期実装完了 (2026-01-04)**
- MCP サーバーの基本実装
- 3つのツール実装:
  - `get_journal_entries`: 日付範囲指定でエントリー取得
  - `search_journal`: キーワード検索
  - `get_recent_entries`: 直近N日間のエントリー取得
- FastMCP を使用したサーバー実装
- パッケージ構成の完成
- ドキュメント (README.md, LICENSE)
- MCP クライアントでの動作確認済み

詳細: [.claude/completed/2026-01-04-initial-implementation.md](.claude/completed/2026-01-04-initial-implementation.md)

✅ **Phase 2: テスト追加完了 (2026-01-04)**
- テストフレームワークのセットアップ (pytest, pytest-cov, pytest-asyncio)
- テストディレクトリ構造の作成 (tests/, tests/fixtures/)
- テストフィクスチャファイルの作成 (サンプル Org ファイル 3つ)
- ユニットテストの実装:
  - `test_converter.py`: 37個のテスト (変換ロジック)
  - `test_server.py`: 12個のテスト (MCP ツール)
  - `test_config.py`: 7個のテスト (設定)
- GitHub Actions CI 設定 (.github/workflows/test.yml)
- README.md にテスト実行方法を追加
- **テスト結果**: 52個のテストが全て成功、カバレッジ 95%

✅ **Phase 3.1: タグフィルタリング機能完了 (2026-01-04)**
- `filter_entries_by_tags` ヘルパー関数を `converter.py` に追加
- `get_entries_by_tag` ツールを `server.py` に実装
- デフォルトで "chore" タグを除外する機能
- include/exclude タグの組み合わせをサポート
- ユニットテストの追加:
  - `test_converter.py`: 9個のテスト (タグフィルタリングロジック)
  - `test_server.py`: 8個のテスト (get_entries_by_tag ツール + 統合テスト)
- README.md にツールの詳細説明を追加
- **テスト結果**: 69個のテストが全て成功、カバレッジ 95%

✅ **Phase 6.1: MCP ツールの入出力説明の追加完了 (2026-01-05)**
- README.md に全 MCP ツール（4つ）の詳細な入出力説明を追加:
  - `get_journal_entries`: パラメータ、返り値形式、エントリーオブジェクトフォーマット、使用例3つ
  - `search_journal`: パラメータ、返り値形式、検索オプション、使用例3つ
  - `get_recent_entries`: 既存の説明を維持
  - `get_entries_by_tag`: 既存の説明を維持
- ユーザーが各ツールの使い方を簡単に理解できるドキュメントを完備

✅ **Phase 7: 環境変数による設定対応完了 (2026-01-05)**
- python-dotenv ライブラリの導入によるクロスプラットフォーム対応
- 実装内容:
  - `pyproject.toml`: `python-dotenv>=1.0.0` を依存関係に追加
  - `config.py`: `load_dotenv()` で .env ファイルを自動読み込み
  - `ORGJOURNAL_DIR` 環境変数のサポート（デフォルト値へのフォールバック付き）
  - `.env.example`: 設定例ファイルを作成（Linux/macOS/Windows/WSL の例を含む）
  - `.gitignore`: `.env` ファイルを除外対象に追加
- README.md に設定方法の詳細ドキュメントを追加:
  - 方法1: .env ファイルによる設定（推奨）
  - 方法2: Claude Desktop 設定での環境変数指定
  - プラットフォーム別の設定例
- 動作確認完了:
  - 依存関係のインストール成功
  - デフォルト設定と .env ファイル設定の両方が正常動作
  - **テスト結果**: 70個のテストが全て成功、カバレッジ 95%維持、config.py は 100%
- メリット:
  - Windows/Mac/Linux 全プラットフォームで動作
  - ユーザーがコードを編集せずに設定変更可能
  - 後方互換性あり（環境変数未設定でもデフォルト値で動作）
  - FastMCP のベストプラクティスに準拠

---

## 次のステップ

### Phase 3: 機能拡張

#### 3.2 統計情報の提供
ジャーナルの統計情報を取得できるようにする。

**新しいツール:**
- `get_journal_stats`: 統計情報取得

**返す情報:**
- エントリー総数
- 期間
- よく使われるタグ Top 10
- 日別エントリー数

#### 3.3 エクスポート機能
- Markdown 形式でのエクスポート
- CSV 形式でのエクスポート

**優先度:** 低

---

### Phase 4: パフォーマンス最適化

**検討事項:**
- 大量のエントリーを扱う場合のメモリ使用量削減
- ファイル読み込みのキャッシング
- インデックスの作成（頻繁に検索する場合）

**優先度:** 低（現時点では問題なし）

---

### Phase 5: エラーハンドリングとロギング

**改善点:**
- より詳細なエラーメッセージ
- ロギング機能の追加（デバッグ用）
- ジャーナルファイルが見つからない場合の適切な処理
- 不正な org ファイル形式への対処

**優先度:** 中

---

### Phase 6: ドキュメントの充実

#### 6.2 その他ドキュメント
- 使用例の追加（より具体的なユースケース）
- トラブルシューティングガイド
- 開発者向けドキュメント（コントリビューションガイド）
- API リファレンス

**優先度:** 低

---

## 将来的な検討事項

### カスタマイズ可能な設定
- ~~ジャーナルディレクトリの柔軟な設定~~ ✅ Phase 7 で完了（環境変数対応）
- 設定ファイル（`.orgjournal-mcp.toml` など）のサポート（将来的に複数設定が必要になった場合）
- エントリーレベルのカスタマイズ（現在は level 4 固定）

### 他の Org-mode 機能のサポート
- TODO 状態の取得
- SCHEDULED/DEADLINE の処理
- プロパティの取得

### リアルタイム監視
- ジャーナルファイルの変更を監視して自動更新

---

## 注意事項

- 現在の実装は **レベル 4 の見出し** (`****`) のみを処理対象としています
- タイムスタンプが存在しないエントリーはスキップされます
- デフォルトのジャーナルディレクトリは `~/Documents/org/p1-journal/` です
  - 環境変数 `ORGJOURNAL_DIR` または `.env` ファイルでカスタマイズ可能（Phase 7）

